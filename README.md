# SPRT

## 순차 확률 비율 검정 (Sequential Probability Ratio Test, SPRT) 설명

### 1. 서론: SPRT의 개념과 필요성

순차 확률 비율 검정(Sequential Probability Ratio Test, 이하 SPRT)은 통계적 가설 검정 방법 중 하나로, 1940년대에 Abraham Wald에 의해 개발되었습니다. 기존의 고정 표본 크기(Fixed Sample Size, FSS) 검정 방식과 달리, SPRT는 데이터를 하나씩 또는 소그룹으로 수집하면서 매 단계마다 현재까지 수집된 데이터를 기반으로 검정을 계속할지, 아니면 두 가설 중 하나를 채택하고 검정을 종료할지를 결정합니다.

SPRT의 가장 큰 장점은 주어진 오류 확률(제1종 오류 α, 제2종 오류 β)을 만족시키면서도, 고정 표본 크기 검정 방식에 비해 **평균적으로 더 적은 수의 표본으로 결론에 도달할 수 있다**는 점입니다. 이는 특히 시험 비용이나 시간이 많이 소요되는 경우(예: 신뢰성 시험, 의약품 임상 시험, 제품 품질 검사)에 매우 유리합니다.

### 2. SPRT의 기본 원리

SPRT는 두 가지 단순 가설 $H_0$ (귀무가설)와 $H_1$ (대립가설)을 비교하는 데 사용됩니다. (참고: 귀무 가설(歸無假說, 영어: null hypothesis, 기호 $H_0$) 또는 영 가설(零假說)은 통계학에서 처음부터 버릴 것을 예상하는 가설이다.)

*   $H_0: \theta = \theta_0$ (모수 $\theta$가 특정 값 $\theta_0$과 같다는 가설)
*   $H_1: \theta = \theta_1$ (모수 $\theta$가 특정 값 $\theta_1$과 같다는 가설, 일반적으로 $\theta_1$은 $\theta_0$보다 좋거나 나쁜 상태를 나타냄)

SPRT는 매 관측값 $X_i$가 수집될 때마다 **누적 확률 비율(Likelihood Ratio)**을 계산합니다. 누적 확률 비율 $L_m$은 $m$번째 관측값까지 수집된 데이터 $X_1, X_2, \dots, X_m$ 하에서 $H_1$이 참일 확률(밀도)과 $H_0$가 참일 확률(밀도)의 비율입니다.

$L_m = \frac{P(X_1, \dots, X_m | H_1)}{P(X_1, \dots, X_m | H_0)} = \frac{\prod_{i=1}^{m} f(X_i | \theta_1)}{\prod_{i=1}^{m} f(X_i | \theta_0)}$

계산의 용이성을 위해 보통 $L_m$의 자연로그를 사용합니다.

$\ln L_m = \sum_{i=1}^{m} \ln \frac{f(X_i | \theta_1)}{f(X_i | \theta_0)}$

여기서 $f(X_i | \theta)$는 모수 $\theta$일 때 $X_i$의 확률 밀도 함수(연속형) 또는 확률 질량 함수(이산형)입니다.

### 3. 결정 규칙: 상한선과 하한선

SPRT의 핵심은 두 개의 문턱값(threshold) 또는 경계(boundary)인 **상한선(Upper Bound, A)**과 **하한선(Lower Bound, B)**을 설정하는 것입니다. 이 경계는 사용자가 허용하는 제1종 오류($\alpha$)와 제2종 오류($\beta$)의 확률에 따라 결정됩니다.

일반적으로 A와 B는 Wald의 근사 공식을 사용하여 다음과 같이 정의됩니다.

*   **상한선 A:** $A \approx \frac{1 - \beta}{\alpha}$
*   **하한선 B:** $B \approx \frac{\beta}{1 - \alpha}$

로그 형태로 변환하면,

*   **로그 상한선 $\ln A$:** $\ln A \approx \ln(\frac{1 - \beta}{\alpha})$
*   **로그 하한선 $\ln B$:** $\ln B \approx \ln(\frac{\beta}{1 - \alpha})$

SPRT의 결정 규칙은 다음과 같습니다. 매 관측값 $X_m$을 수집한 후 누적 확률 비율 $L_m$ (또는 $\ln L_m$)을 계산합니다.

1.  **$L_m \ge A$ (또는 $\ln L_m \ge \ln A$) 이면:** $H_1$을 채택하고 검정을 종료합니다.
2.  **$L_m \le B$ (또는 $\ln L_m \le \ln B$) 이면:** $H_0$를 채택하고 검정을 종료합니다.
3.  **$B < L_m < A$ (또는 $\ln B < \ln L_m < \ln A$) 이면:** 더 많은 데이터를 수집하고 검정을 계속합니다.

이 과정은 $L_m$이 경계를 넘어설 때까지 반복됩니다.

### 4. SPRT의 작동 예시: 전구 수명 시험

평균 수명이 $\mu$인 전구의 수명을 검정한다고 가정해 봅시다. 전구의 수명은 지수 분포를 따른다고 알려져 있습니다. 우리는 새로운 제조 공정이 기존 공정보다 평균 수명을 증가시켰는지 확인하고 싶습니다.

*   **귀무가설 $H_0$:** 전구의 평균 수명은 $\mu_0$ (기존 공정)
*   **대립가설 $H_1$:** 전구의 평균 수명은 $\mu_1$ (새로운 공정), 여기서 $\mu_1 > \mu_0$

우리는 각 전구의 수명 $T_i$를 관측합니다. 지수 분포의 확률 밀도 함수는 $f(t|\mu) = \frac{1}{\mu} e^{-t/\mu}$ 입니다.

이 경우, 개별 관측값의 로그 확률 비율은 다음과 같습니다.

$\ln \frac{f(T_i | \mu_1)}{f(T_i | \mu_0)} = \ln \frac{\frac{1}{\mu_1} e^{-T_i/\mu_1}}{\frac{1}{\mu_0} e^{-T_i/\mu_0}} = \ln \frac{\mu_0}{\mu_1} + T_i \left(\frac{1}{\mu_0} - \frac{1}{\mu_1}\right)$

누적 로그 확률 비율은

$\ln L_m = \sum_{i=1}^{m} \left[ \ln \frac{\mu_0}{\mu_1} + T_i \left(\frac{1}{\mu_0} - \frac{1}{\mu_1}\right) \right] = m \ln \frac{\mu_0}{\mu_1} + \left(\frac{1}{\mu_0} - \frac{1}{\mu_1}\right) \sum_{i=1}^{m} T_i$

우리는 이 $\ln L_m$ 값을 미리 설정된 $\ln B$와 $\ln A$와 비교하여 검정을 계속할지, $H_0$를 채택할지, $H_1$을 채택할지 결정합니다.

### 5. SPRT의 특징 및 장점

*   **표본 크기의 효율성:** SPRT의 가장 큰 장점은 주어진 오류 확률($\alpha, \beta$)을 만족시키면서도, 고정 표본 크기 검정에 비해 평균적으로 20% ~ 50% 더 적은 수의 표본이 필요하다는 것입니다. 이는 시험 비용과 시간을 절약하는 데 매우 효과적입니다.
*   **연속적인 의사결정:** 데이터가 수집될 때마다 즉각적인 의사결정을 할 수 있어, 불필요한 데이터 수집을 방지하고 빠르게 결론에 도달할 수 있습니다.
*   **다양한 분포에 적용 가능:** 정규 분포, 지수 분포, 이항 분포 등 다양한 확률 분포에 적용할 수 있습니다.
*   **실시간 모니터링:** 생산 라인 품질 관리, 신뢰성 시험, 임상 시험 등 실시간 모니터링이 필요한 상황에 적합합니다.

### 6. SPRT의 한계점

*   **두 가지 단순 가설:** SPRT는 기본적으로 두 가지 단순 가설($\theta = \theta_0$ vs $\theta = \theta_1$)에 대해 최적화되어 있습니다. 복합 가설(예: $\theta \le \theta_0$ vs $\theta > \theta_0$)에 직접 적용하려면 변형이 필요하며, 이때 최적의 효율성을 보장하기 어렵습니다.
*   **종료 보장:** 이론적으로는 SPRT가 항상 유한한 수의 표본에서 종료될 확률이 1에 가깝지만, 특정 상황에서는 검정이 예상보다 오래 지속되거나 명확한 결론에 도달하지 못할 위험이 있습니다. 이 경우 최대 표본 크기 제한을 두는 것이 일반적입니다.
*   **복잡한 계산:** 고정 표본 크기 검정에 비해 각 단계마다 확률 비율을 계산해야 하므로, 수작업보다는 컴퓨터 프로그램이 필요합니다.
*   **정확한 오류 확률:** Wald의 경계 공식은 근사치이므로, 실제 오류 확률($\alpha', \beta'$)은 설정된 $\alpha, \beta$와 약간의 차이가 있을 수 있습니다. 그러나 이 차이는 일반적으로 보수적인 방향(실제 오류가 설정 오류보다 작음)으로 나타납니다.

### 7. 결론

SPRT는 자원 효율적인 통계적 가설 검정을 위한 강력한 도구입니다. 특히 비용이 많이 들거나 시간이 중요한 응용 분야에서 그 가치가 큽니다. 데이터가 순차적으로 도착하고 즉각적인 의사결정이 필요한 경우, SPRT는 기존의 고정 표본 크기 검정 방식보다 효율적이고 유연한 대안을 제공합니다. 그러나 그 한계점을 이해하고 적절하게 적용하는 것이 중요하며, 실제 적용 시에는 모수의 분포 가정과 경계 설정에 대한 신중한 고려가 필요합니다.
`
